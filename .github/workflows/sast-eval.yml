name: SAST Tool Evaluation Workflow

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  sast-scan:
    name: Run SAST Checks
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      # Semgrep Scan
      - name: Semgrep Scan
        uses: returntocorp/semgrep-action@v1
        with:
          config: security/sast/configs/semgrep/semgrep-config.yaml
        continue-on-error: true

      # SDK/Setup for Sonar (Simulated/Placeholder as server is needed)
      - name: SonarQube Scan Setup
        run: |
          echo "SonarQube assumes a running server."
          echo "Config found at security/sast/configs/sonarqube/sonar-project.properties"
          # In a real scenario:
          # sonar-scanner -Dproject.settings=security/sast/configs/sonarqube/sonar-project.properties

      # Trivy Scan (Filesystem)
      - name: Trivy FS Scan
        uses: aquasecurity/trivy-action@master
        with:
          scan-type: 'fs'
          scan-ref: '.'
          trivy-config: security/trivy/trivy.yaml
          format: 'table'
          exit-code: '0'
          ignore-unfixed: true
          vuln-type: 'os,library'
        continue-on-error: true
